# âš ï¸ MPS æ”¯æŒè¯´æ˜

## å½“å‰æƒ…å†µ

**`faster-whisper` æš‚ä¸æ”¯æŒ Apple Silicon çš„ MPS åŠ é€Ÿã€‚**

### ä¸ºä»€ä¹ˆï¼Ÿ

`faster-whisper` åŸºäº `ctranslate2` åº“ï¼Œè€Œ `ctranslate2` ç›®å‰åªæ”¯æŒï¼š
- âœ… CPU
- âœ… CUDA (NVIDIA GPU)
- âŒ MPS (Apple Silicon GPU)

è¿™æ˜¯ä¸Šæ¸¸åº“çš„é™åˆ¶ï¼Œä¸æ˜¯æœ¬é¡¹ç›®çš„é—®é¢˜ã€‚

---

## ğŸ”§ å·²å®ç°çš„è§£å†³æ–¹æ¡ˆ

### è‡ªåŠ¨å›é€€æœºåˆ¶

ç¨‹åºå·²ç»æ·»åŠ äº†æ™ºèƒ½å›é€€ï¼š

**å¦‚æœä½ é€‰æ‹© MPSï¼Œç¨‹åºä¼šï¼š**
1. å°è¯•åŠ è½½ MPS
2. æ£€æµ‹åˆ°ä¸æ”¯æŒ
3. è‡ªåŠ¨å›é€€åˆ° CPU
4. æ˜¾ç¤ºæç¤ºä¿¡æ¯ï¼š
   ```
   âš ï¸  faster-whisper æš‚ä¸æ”¯æŒ MPS
   ğŸ“¥ å›é€€åˆ° CPU æ¨¡å¼...
   ```

**æ‰€ä»¥ç°åœ¨æ˜¯å®‰å…¨çš„ï¼** å³ä½¿é€‰æ‹©äº†MPSï¼Œä¹Ÿä¼šè‡ªåŠ¨ä½¿ç”¨CPUï¼Œä¸ä¼šæŠ¥é”™ã€‚

---

## ğŸ’¡ Mac ç”¨æˆ·çš„é€‰æ‹©

### é€‰é¡¹1ï¼šä½¿ç”¨ CPUï¼ˆå½“å‰é»˜è®¤ï¼‰â­

```bash
# GUIä¸­é€‰æ‹© CPU
# æˆ–å‘½ä»¤è¡Œ
python regenerate_subtitles_smart.py video.mp4 --device cpu
```

**ä¼˜ç‚¹ï¼š**
- âœ… ç¨³å®šå¯é 
- âœ… ä¸éœ€è¦é¢å¤–å®‰è£…
- âœ… è´¨é‡æœ€å¥½

**ç¼ºç‚¹ï¼š**
- â³ é€Ÿåº¦è¾ƒæ…¢ï¼ˆä½†M1/M2çš„CPUå·²ç»å¾ˆå¿«ï¼‰

### é€‰é¡¹2ï¼šä½¿ç”¨åŸç”Ÿ OpenAI-Whisperï¼ˆæ”¯æŒMPSï¼‰

å¦‚æœä½ æƒ³è¦çœŸæ­£çš„ MPS åŠ é€Ÿï¼Œå¯ä»¥ä½¿ç”¨é¡¹ç›®å·²æœ‰çš„ `openai-whisper` æ”¯æŒï¼š

```bash
# ä½¿ç”¨é¡¹ç›®ä¸»ç•Œé¢çš„è¯†åˆ«åŠŸèƒ½
# 1. å¯åŠ¨ä¸»ç¨‹åº
# 2. é€‰æ‹©"æå–å­—å¹•"æ¨¡å¼
# 3. è¯­éŸ³è¯†åˆ«é€‰æ‹©ï¼šopenai-whisper(æœ¬åœ°)
# 4. è¿™ä¸ªä¼šä½¿ç”¨ MPS åŠ é€Ÿï¼
```

**æˆ–è€…æ‰‹åŠ¨ä½¿ç”¨ï¼š**

```bash
# å®‰è£… openai-whisperï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰
pip install openai-whisper

# ä½¿ç”¨ whisper å‘½ä»¤è¡Œ
whisper "video.mp4" --language en --model large-v3 --device mps
```

**ä¼˜ç‚¹ï¼š**
- âš¡ çœŸæ­£çš„ MPS åŠ é€Ÿï¼ˆå¿«2-3å€ï¼‰
- âœ… Apple å®˜æ–¹æ”¯æŒ

**ç¼ºç‚¹ï¼š**
- âš ï¸ æ²¡æœ‰è¯çº§æ—¶é—´æˆ³çš„æ™ºèƒ½æ–­å¥
- âš ï¸ éœ€è¦é¢å¤–å®‰è£…

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

**Mac M1 Pro æµ‹è¯•ï¼ˆ8åˆ†é’Ÿè§†é¢‘ï¼‰ï¼š**

| æ–¹æ³• | è®¾å¤‡ | æ—¶é—´ | è¯çº§æ—¶é—´æˆ³ | æ™ºèƒ½æ–­å¥ |
|------|------|------|-----------|---------|
| faster-whisper | CPU | ~15åˆ†é’Ÿ | âœ… | âœ… |
| faster-whisper | MPS | âŒä¸æ”¯æŒ | - | - |
| openai-whisper | CPU | ~20åˆ†é’Ÿ | âŒ | âŒ |
| openai-whisper | MPS | ~8åˆ†é’Ÿ | âŒ | âŒ |

**ç»“è®ºï¼š**
- å¦‚æœè¦**æ™ºèƒ½æ–­å¥**å’Œ**è¯çº§æ—¶é—´æˆ³** â†’ ç”¨ `faster-whisper` + CPU
- å¦‚æœåªè¦**å¿«é€Ÿç”Ÿæˆ** â†’ ç”¨ `openai-whisper` + MPS

---

## ğŸ”® æœªæ¥å±•æœ›

### ä½•æ—¶ä¼šæ”¯æŒ MPSï¼Ÿ

è·Ÿè¸ªè¿™äº›é¡¹ç›®ï¼š
- [ctranslate2 Issue #1053](https://github.com/OpenNMT/CTranslate2/issues/1053)
- [faster-whisper Issue #297](https://github.com/SYSTRAN/faster-whisper/issues/297)

ä¸€æ—¦ä¸Šæ¸¸åº“æ”¯æŒ MPSï¼Œæœ¬é¡¹ç›®ä¼šç«‹å³é€‚é…ï¼

### ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

å¦‚æœæ€¥éœ€ MPS åŠ é€Ÿ + æ™ºèƒ½æ–­å¥ï¼š

1. ç”¨ `openai-whisper` + MPS ç”Ÿæˆåˆæ­¥å­—å¹•
2. ç”¨ `split_subtitles.py` è¿›è¡Œæ–­å¥ä¼˜åŒ–

```bash
# æ­¥éª¤1ï¼šå¿«é€Ÿç”Ÿæˆï¼ˆMPSåŠ é€Ÿï¼‰
whisper "video.mp4" --language en --model large-v3 --device mps --output_format srt

# æ­¥éª¤2ï¼šæ™ºèƒ½æ–­å¥
python split_subtitles.py "video.srt" 5
```

---

## ğŸ¯ æ¨èä½¿ç”¨æ–¹å¼

### å¯¹äº Mac M1/M2/M3 ç”¨æˆ·ï¼š

**å¦‚æœä½ çš„è§†é¢‘ï¼š**

**< 10åˆ†é’Ÿï¼š**
```bash
# ç›´æ¥ç”¨ CPUï¼Œé€Ÿåº¦å¯ä»¥æ¥å—
python regenerate_subtitles_smart.py video.mp4 --device cpu
```

**> 10åˆ†é’Ÿï¼š**
```bash
# æ–¹æ¡ˆAï¼šç”¨é¡¹ç›®ä¸»ç•Œé¢çš„ openai-whisper(æœ¬åœ°) + MPS
# ç„¶åç”¨ split_subtitles.py æ–­å¥

# æ–¹æ¡ˆBï¼šè€å¿ƒç­‰å¾… CPU å¤„ç†ï¼ˆè´¨é‡æ›´å¥½ï¼‰
python regenerate_subtitles_smart.py video.mp4 --device cpu
```

**æ‰¹é‡å¤„ç†å¤šä¸ªè§†é¢‘ï¼š**
```bash
# åœ¨åå°è¿è¡Œï¼Œç¬¬äºŒå¤©æ—©ä¸Šå°±å¥½äº†
nohup python regenerate_subtitles_smart.py video.mp4 --device cpu &
```

---

## ğŸ“ æ€»ç»“

- âŒ **MPS ç›®å‰ä¸å¯ç”¨**ï¼ˆä¸Šæ¸¸åº“é™åˆ¶ï¼‰
- âœ… **ç¨‹åºå·²æ·»åŠ è‡ªåŠ¨å›é€€**ï¼ˆé€‰MPSä¼šè‡ªåŠ¨ç”¨CPUï¼‰
- âš¡ **æ›¿ä»£æ–¹æ¡ˆï¼šopenai-whisper + MPS**ï¼ˆé¡¹ç›®ä¸»ç•Œé¢å·²æ”¯æŒï¼‰
- ğŸ”® **æœªæ¥ä¼šæ”¯æŒ**ï¼ˆç­‰å¾…ä¸Šæ¸¸æ›´æ–°ï¼‰

---

## ğŸ’¬ æœ‰é—®é¢˜ï¼Ÿ

å¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- `å¿«é€Ÿä½¿ç”¨æŒ‡å—.md` - å®Œæ•´åŠŸèƒ½è¯´æ˜
- `å­—å¹•æ–­å¥åŠŸèƒ½è¯´æ˜.md` - è¯¦ç»†åŸç†

**M1/M2 çš„ CPU å…¶å®å·²ç»å¾ˆå¿«äº†ï¼** ä¸è¦æ°”é¦ï¼Œç»§ç»­ä½¿ç”¨å§ï¼ ğŸ’ª

