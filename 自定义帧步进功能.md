# 自定义帧步进功能 ✅

## 🎉 新增功能

在帧微调按钮的基础上，新增了**自定义步进帧数**功能！现在您可以设置每次跳转5帧、10帧、甚至更多！

## 📸 界面效果

```
┌──────────────────────────────────────────────────┐
│           视频预览区域 (640×360)                  │
└──────────────────────────────────────────────────┘

00:01:23 步进:[5] [◀-5帧] ━━━◉━━━ [+5帧▶] 00:05:30
         ↑      ↑                    ↑
       设置    向前5帧              向后5帧
```

## ✨ 核心功能

### 1️⃣ **步进设置输入框**
- **位置**: 时间轴左侧，紧挨当前时间
- **默认值**: 1帧
- **范围**: 1-100帧
- **实时更新**: 输入后按钮文字立即变化

### 2️⃣ **动态按钮文本**
- 输入 `1` → 按钮显示 `◀ -1帧` / `+1帧 ▶`
- 输入 `5` → 按钮显示 `◀ -5帧` / `+5帧 ▶`
- 输入 `10` → 按钮显示 `◀ -10帧` / `+10帧 ▶`
- 输入 `30` → 按钮显示 `◀ -30帧` / `+30帧 ▶`

### 3️⃣ **智能范围限制**
- 最小值: 1帧
- 最大值: 100帧
- 自动纠正: 输入超范围会自动限制

## 🚀 使用方法

### 基本操作

#### 方式1: 使用默认步进（1帧）
```
直接点击 [◀-1帧] 或 [+1帧▶]
= 逐帧精确控制
```

#### 方式2: 设置大步进（5帧）
```
1. 在"步进"输入框输入 5
2. 按钮自动变为 [◀-5帧] 和 [+5帧▶]
3. 点击按钮，每次跳5帧
```

#### 方式3: 快速浏览（10帧）
```
1. 输入 10
2. 按钮变为 [◀-10帧] 和 [+10帧▶]
3. 快速点击浏览视频
```

#### 方式4: 大范围跳转（30帧）
```
1. 输入 30
2. 按钮变为 [◀-30帧] 和 [+30帧▶]
3. 快速跳过大片段
```

### 使用场景

#### 场景1: 快速跳过片头
```
问题: 视频前30秒是片头动画
解决:
1. 设置步进为 30（25fps视频约1秒）
2. 连续点击 [+30帧▶] 快速跳过
3. 接近目标后，改为步进 1 精确定位
```

#### 场景2: 浏览长视频
```
问题: 5分钟视频，想快速浏览
解决:
1. 设置步进为 50
2. 连续点击 [+50帧▶]
3. 每次跳约2秒（25fps）
4. 快速找到目标区域
```

#### 场景3: 跳过重复场景
```
问题: 某段场景重复，持续3秒
解决:
1. 设置步进为 75（25fps × 3秒）
2. 点击 [+75帧▶] 一次跳过
3. 节省时间
```

#### 场景4: 精确微调
```
问题: 找到大概位置，需要精确定位
解决:
1. 先用步进 10 快速接近
2. 改为步进 1 精确微调
3. 找到完美的帧
```

## 📊 步进值推荐

### 根据视频帧率

| 视频帧率 | 步进值 | 时间跨度 | 适用场景 |
|---------|--------|---------|---------|
| 25 fps | 1 | 40ms | 精确定位 |
| 25 fps | 5 | 200ms | 微调浏览 |
| 25 fps | 25 | 1秒 | 快速跳转 |
| 25 fps | 50 | 2秒 | 快速浏览 |
| 30 fps | 1 | 33ms | 精确定位 |
| 30 fps | 30 | 1秒 | 快速跳转 |
| 30 fps | 60 | 2秒 | 快速浏览 |
| 60 fps | 1 | 17ms | 精确定位 |
| 60 fps | 60 | 1秒 | 快速跳转 |

### 通用推荐

| 步进值 | 用途 | 说明 |
|--------|------|------|
| 1 | 精确定位 | 逐帧查看，最精确 |
| 5 | 快速微调 | 跳过几帧，稍快 |
| 10 | 中速浏览 | 平衡速度和精度 |
| 25-30 | 按秒跳转 | 快速跳过整秒 |
| 50-60 | 快速浏览 | 每次约2秒 |
| 100 | 超快跳转 | 跳过大段内容 |

## 🎯 工作流程建议

### 流程1: 从粗到精
```
1. 滑块拖到大概位置
   ↓
2. 设置步进 = 10，快速接近
   ↓
3. 设置步进 = 5，进一步接近
   ↓
4. 设置步进 = 1，精确定位
   ↓
5. 调整字幕参数
```

### 流程2: 快速浏览
```
1. 设置步进 = 50
   ↓
2. 连续点击 [+50帧▶] 快速浏览
   ↓
3. 发现目标区域，设置步进 = 1
   ↓
4. 精确定位到目标帧
```

## 💡 使用技巧

### 技巧1: 动态调整步进
```
不要一直用同一个步进值！
远距离 → 大步进（50）
中距离 → 中步进（10）
近距离 → 小步进（1）
```

### 技巧2: 记住常用值
```
我的常用设置：
- 精确: 1
- 微调: 5
- 快速: 25
- 超快: 50
```

### 技巧3: 根据帧率调整
```
25fps视频 → 步进25 = 1秒
30fps视频 → 步进30 = 1秒
60fps视频 → 步进60 = 1秒
```

### 技巧4: 输入框快捷操作
```
双击输入框 → 全选
输入新值 → 按Enter确认
Tab键 → 快速切换到输入框
```

## 🔧 技术实现

### 核心方法

#### 1. 获取步进值
```python
def _get_frame_step(self):
    try:
        step = int(self.frame_step_input.text())
        # 限制在1-100之间
        return max(1, min(step, 100))
    except:
        return 1  # 默认值
```

#### 2. 更新按钮文本
```python
def _update_frame_buttons_text(self):
    step = self._get_frame_step()
    self.frame_prev_btn.setText(f"◀ -{step}帧")
    self.frame_next_btn.setText(f"+{step}帧 ▶")
```

#### 3. 向前/向后N帧
```python
def _on_prev_frame(self):
    step = self._get_frame_step()
    self._adjust_frame(-step)  # 负数 = 向前

def _on_next_frame(self):
    step = self._get_frame_step()
    self._adjust_frame(step)   # 正数 = 向后
```

#### 4. 调整帧数
```python
def _adjust_frame(self, frame_count):
    # 计算一帧的时长
    frame_duration_ms = 1000 / fps
    
    # 计算新位置
    new_time = current_time + (frame_count × frame_duration_ms)
    
    # 限制范围
    new_time = max(0, min(new_time, video_duration))
```

### 计算示例

#### 示例1: 25fps视频，步进10帧
```
一帧时长 = 1000ms / 25 = 40ms
跳转时长 = 40ms × 10 = 400ms = 0.4秒
```

#### 示例2: 30fps视频，步进30帧
```
一帧时长 = 1000ms / 30 = 33.3ms
跳转时长 = 33.3ms × 30 = 1000ms = 1秒
```

#### 示例3: 60fps视频，步进60帧
```
一帧时长 = 1000ms / 60 = 16.7ms
跳转时长 = 16.7ms × 60 = 1000ms = 1秒
```

## 📂 代码修改

### videotrans/ui/vasrt.py

**新增UI组件**:
```python
self.frame_step_label        # "步进:" 标签
self.frame_step_input        # 步进值输入框（默认1）
```

**新增方法**:
```python
_get_frame_step()            # 获取用户设置的步进值
_update_frame_buttons_text() # 更新按钮文本
_on_prev_frame()            # 向前N帧处理
_on_next_frame()            # 向后N帧处理
```

**修改方法**:
```python
_adjust_frame(frame_count)   # 改为接受帧数参数（而非方向）
```

## ⚙️ 输入验证

### 自动修正
```python
输入: 0   → 自动修正为: 1
输入: -5  → 自动修正为: 1
输入: 200 → 自动修正为: 100
输入: abc → 自动修正为: 1
```

### 范围限制
- **最小值**: 1（不能小于1帧）
- **最大值**: 100（避免跳太远）
- **默认值**: 1（最精确）

## 📊 性能对比

| 操作 | 之前 | 现在 | 效率提升 |
|------|------|------|---------|
| 跳过10帧 | 点击10次 | 设置10，点击1次 | **10倍** |
| 跳过30帧 | 点击30次 | 设置30，点击1次 | **30倍** |
| 跳过1秒(25fps) | 点击25次 | 设置25，点击1次 | **25倍** |
| 跳过1秒(60fps) | 点击60次 | 设置60，点击1次 | **60倍** |

## 🎯 功能对比

### 版本1.2 - 固定步进
- ✅ 向前/向后一帧
- ❌ **每次只能跳1帧**
- ❌ **快速浏览效率低**

### 版本1.3 - 自定义步进 ⭐
- ✅ 向前/向后N帧
- ✅ **自定义步进值（1-100）**
- ✅ **大幅提高浏览效率**
- ✅ **按钮文本实时更新**
- ✅ **灵活适应不同场景**

## ⚠️ 注意事项

### 1. 步进值的选择
- 精确定位: 使用步进 1
- 快速浏览: 使用步进 10-50
- 不要一直用大步进，容易错过目标

### 2. 视频范围限制
- 自动限制在视频范围内
- 到达开头/结尾时，继续点击不会超出

### 3. 按钮文本更新
- 输入步进值后，按钮文本立即更新
- 无需按Enter确认

### 4. 响应时间
- 步进越大，跳转距离越远
- 但每次仍需提取新帧，需等待1-2秒

## 💯 最佳实践

### 实践1: 三级定位法
```
第一级: 滑块（秒级） → 定位到分钟
第二级: 大步进（25-50帧） → 定位到秒
第三级: 小步进（1帧） → 精确定位
```

### 实践2: 快速浏览法
```
1. 设置步进 = 50
2. 快速连续点击
3. 发现目标立即停止
4. 改步进 = 1，精确定位
```

### 实践3: 动态调整法
```
距离远 → 步进大（50）
距离中 → 步进中（10）
距离近 → 步进小（1）
找到了 → 停止调整
```

## 🎉 功能总结

### 实现的功能
✅ 自定义步进值输入框  
✅ 步进范围1-100帧  
✅ 按钮文本动态更新  
✅ 向前/向后N帧  
✅ 自动范围验证  
✅ 效率大幅提升  

### 技术亮点
⭐ 实时更新按钮文本  
⭐ 智能输入验证  
⭐ 灵活步进控制  
⭐ 大幅提高浏览效率  
⭐ 完美向后兼容  

## 🚀 开始使用

```bash
# 1. 启动程序
python sp.py

# 2. 选择视频文件

# 3. 在"步进"输入框设置帧数（如：10）

# 4. 点击 [◀-10帧] 或 [+10帧▶]

# 5. 每次跳转10帧，效率提升10倍！
```

---

**开发完成日期**: 2025-10-10  
**版本**: 1.3  
**状态**: ✅ 完成并测试通过  

现在您可以自定义步进值，大幅提高浏览效率了！🎬✨

