# LLM 智能字幕分割功能使用说明

## ✨ 功能概述

LLM 智能字幕分割功能已成功迁移到 `get_srt_zimu` 项目中！该功能使用大语言模型（LLM）对字幕进行智能断句优化，基于语义理解而非简单的规则引擎。

## 🎯 主要特性

### 1. **多 LLM 提供商支持**
- ✅ **SiliconFlow** (推荐，国内速度快)
- ✅ **OpenAI** (GPT-4, GPT-3.5)
- ✅ **Claude** (Anthropic)
- ✅ **DeepSeek** (国产大模型)

### 2. **流式输出**
- 实时显示 LLM 生成过程
- 提供详细的处理日志
- 支持进度追踪

### 3. **智能时间戳映射**
- 自动将 LLM 分割的文本段映射到原始时间戳
- 保持字幕同步准确性

### 4. **API Key 管理**
- 自动保存 API Key 到 `.env` 文件
- 支持多提供商独立配置
- 密码输入模式保护隐私

## 📖 使用步骤

### 第一步：配置 LLM

1. **选择提供商**
   - 推荐使用 `SiliconFlow`（国内速度快，价格便宜）
   - 或选择 `OpenAI`、`Claude`、`DeepSeek`

2. **输入 API Key**
   - 在「API Key」输入框中输入你的密钥
   - 系统会自动保存到配置文件

3. **选择模型**
   - SiliconFlow: `Qwen/Qwen2.5-7B-Instruct`（推荐）
   - OpenAI: `gpt-4o-mini`
   - Claude: `claude-3-5-sonnet-20241022`
   - DeepSeek: `deepseek-chat`

### 第二步：选择字幕文件

1. 点击「📂 选择 SRT 文件」按钮
2. 选择你要优化的 `.srt` 字幕文件
3. 系统会显示文件名

### 第三步：开始处理

1. 点击「✨ 开始智能分割」按钮
2. 在日志区域查看实时处理进度
3. 等待 LLM 完成分析和分割

### 第四步：查看结果

1. 处理完成后会弹出提示
2. 点击「📂 打开输出文件夹」查看结果
3. 输出文件名为：`原文件名_llm_split.srt`

## 🔧 技术实现

### 核心文件

```
get_srt_zimu/
├── utils/
│   └── llm_processor.py       # LLM 处理器核心逻辑
└── ui/
    └── split_view.py           # UI 界面和交互逻辑
```

### 处理流程

```
1. 解析原始 SRT 文件
   ↓
2. 提取完整文本
   ↓
3. 调用 LLM API 进行智能分割
   ↓
4. 解析 LLM 返回的 JSON 结果
   ↓
5. 映射时间戳到新分段
   ↓
6. 保存新的 SRT 文件
```

### LLM Prompt 策略

使用精心设计的 prompt 来指导 LLM：
- 要求每段 3-6 秒（10-15 词）
- 在自然的短语边界分割
- 保持语义完整性
- 考虑阅读速度和理解难度
- 输出标准 JSON 格式

## 🌟 API Key 获取

### SiliconFlow (推荐)
1. 访问：https://siliconflow.cn/
2. 注册账号
3. 进入「API Keys」页面创建密钥
4. 💰 价格低廉，速度快，国内访问稳定

### OpenAI
1. 访问：https://platform.openai.com/api-keys
2. 创建 API Key
3. ⚠️ 需要国际网络访问

### Claude (Anthropic)
1. 访问：https://console.anthropic.com/
2. 申请 API 访问权限
3. 创建 API Key

### DeepSeek
1. 访问：https://platform.deepseek.com/
2. 注册并创建 API Key
3. 💰 国产大模型，价格实惠

## ⚙️ 配置文件位置

API Key 会自动保存到：
```
~/Videos/pyvideotrans/get_srt_zimu/.env
```

格式示例：
```env
SILICONFLOW_API_KEY=sk-xxx
OPENAI_API_KEY=sk-xxx
CLAUDE_API_KEY=sk-ant-xxx
DEEPSEEK_API_KEY=sk-xxx
```

## 🎨 界面特色

- **现代化设计**：清爽的界面，清晰的视觉层次
- **实时反馈**：流式输出让你看到 LLM 的"思考"过程
- **详细日志**：完整记录每一步操作
- **智能提示**：根据状态给出操作建议

## 🔗 工作流程整合

### 推荐工作流

1. **生成字幕** → 使用「🎙️ 生成字幕」功能，用 Whisper 从视频生成原始字幕
2. **智能分割** → 使用「✂️ 智能分割」功能，用 LLM 优化断句
3. **渲染视频** → 使用「🎥  视频渲染」功能，将优化后的字幕烧录到视频

### 快速跳转

生成字幕完成后，点击「✂️ 继续智能分割字幕」按钮，可自动跳转到智能分割页面并预填充文件。

## ❓ 常见问题

### Q1: API Key 无效？
**A:** 请检查：
- Key 是否正确复制（没有多余空格）
- 账户余额是否充足
- 提供商是否正确选择

### Q2: 处理速度慢？
**A:** 
- LLM 处理需要时间，特别是长字幕
- SiliconFlow 通常比 OpenAI 快
- 可以在日志区域看到实时进度

### Q3: 时间戳不准确？
**A:** 
- 系统会尽力映射时间戳
- 如果 LLM 返回的文本与原文差异较大，可能影响映射准确性
- 可以尝试不同的模型

### Q4: 支持哪些语言？
**A:** 
- 支持 LLM 能理解的所有语言
- 中文、英文效果最好
- 其他语言取决于 LLM 的多语言能力

## 📊 性能参考

| 提供商 | 速度 | 价格 | 质量 | 推荐度 |
|--------|------|------|------|--------|
| SiliconFlow | ⚡⚡⚡ | 💰 | ⭐⭐⭐⭐ | ★★★★★ |
| OpenAI GPT-4 | ⚡⚡ | 💰💰💰 | ⭐⭐⭐⭐⭐ | ★★★★☆ |
| Claude | ⚡⚡ | 💰💰 | ⭐⭐⭐⭐⭐ | ★★★★☆ |
| DeepSeek | ⚡⚡⚡ | 💰 | ⭐⭐⭐⭐ | ★★★★☆ |

## 🎉 迁移完成总结

✅ **核心功能已完全迁移**
- LLM API 调用（支持流式输出）
- 多提供商支持
- 智能时间戳映射
- API Key 管理

✅ **UI 体验优化**
- 现代化界面设计
- 实时进度显示
- 完整的错误提示
- 与其他功能无缝集成

✅ **代码结构清晰**
- 模块化设计
- 易于维护和扩展
- 完整的注释和文档

---

**享受 AI 驱动的智能字幕优化体验！** 🚀

