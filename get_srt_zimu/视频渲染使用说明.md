# 🎬 视频渲染字幕功能使用说明

## 功能概述

视频渲染功能可以将字幕文件烧录到视频中，并支持音频合并。这是一个完整的视频后期处理工具。

## 核心功能

### 1. 字幕渲染
- **硬字幕（烧录）**：将字幕永久嵌入视频画面，播放器无法关闭
- **软字幕（内嵌）**：将字幕作为独立轨道嵌入视频文件，播放器可以选择开关

### 2. 音频合并
- 支持将外部音频文件合并到视频中
- 可以替换原视频的音频轨道
- 自动处理音频时长匹配

### 3. 样式定制
- **字体大小**：小、中、大、特大
- **字幕位置**：底部、顶部、中间
- **描边效果**：提高字幕可读性

## 使用步骤

### 基础流程

1. **选择文件**
   - **视频文件**（必选）：支持 MP4、MOV、AVI、MKV、FLV、WMV、WebM 等格式
   - **音频文件**（可选）：支持 MP3、WAV、M4A、AAC、FLAC、OGG 等格式
   - **字幕文件**（可选）：支持 SRT、ASS 格式

2. **配置样式**
   - 选择字幕类型（硬字幕/软字幕）
   - 设置字体大小
   - 选择字幕位置
   - 勾选是否添加描边

3. **输出设置**
   - 选择是否合并音频
   - 自定义输出文件名（可选，留空自动生成）

4. **开始渲染**
   - 点击"开始渲染"按钮
   - 查看实时处理日志
   - 等待渲染完成

5. **获取结果**
   - 渲染完成后，点击"打开输出文件夹"
   - 输出文件默认命名为：`原文件名_rendered.mp4`

## 使用场景

### 场景 1：只烧录字幕
```
输入：
- 视频：video.mp4
- 字幕：subtitle.srt

输出：
- video_rendered.mp4（带烧录字幕的视频）
```

### 场景 2：合并音频和字幕
```
输入：
- 视频：video.mp4
- 音频：audio.mp3
- 字幕：subtitle.srt

输出：
- video_rendered.mp4（音频+字幕的完整视频）
```

### 场景 3：只合并音频
```
输入：
- 视频：video.mp4
- 音频：audio.mp3

输出：
- video_rendered.mp4（替换音频的视频）
```

### 场景 4：软字幕
```
输入：
- 视频：video.mp4
- 字幕：subtitle.srt
- 字幕类型：软字幕（内嵌）

输出：
- video_rendered.mp4（内嵌字幕轨道，播放器可控制显示）
```

## 硬字幕 vs 软字幕

### 硬字幕（烧录）
✅ **优点**：
- 字幕永久显示，任何播放器都能看到
- 可以自定义样式（大小、位置、描边）
- 适合分享到社交平台

❌ **缺点**：
- 渲染时间较长（需要重新编码）
- 无法关闭或修改字幕
- 文件体积可能较大

### 软字幕（内嵌）
✅ **优点**：
- 处理速度快（不需要重新编码视频）
- 播放器可以选择开关字幕
- 文件体积小

❌ **缺点**：
- 样式固定，无法自定义
- 部分播放器可能不支持
- 不适合分享到不支持字幕的平台

## 技术细节

### 依赖要求
- **FFmpeg**：必须安装并添加到系统 PATH
  - macOS: `brew install ffmpeg`
  - Ubuntu: `sudo apt install ffmpeg`
  - Windows: 下载并配置环境变量

### 字幕样式参数

#### 字体大小映射
- 小：18px
- 中：24px（推荐）
- 大：32px
- 特大：48px

#### 位置对齐
- 底部：底部居中（最常用）
- 顶部：顶部居中
- 中间：屏幕中央

#### 描边效果
- BorderStyle=1：描边模式
- Outline=2：描边宽度
- Shadow=1：阴影效果

### 性能优化

1. **硬字幕渲染参数**：
   - 编码器：libx264（H.264）
   - CRF：23（质量系数，越小质量越好）
   - Preset：medium（速度/质量平衡）

2. **软字幕处理**：
   - 视频流：copy（不重新编码）
   - 音频流：copy（不重新编码）
   - 字幕流：mov_text（MP4 兼容格式）

## 常见问题

### Q1: 提示"未找到 ffmpeg"
**A**: 需要安装 FFmpeg 并确保添加到系统 PATH。

### Q2: 渲染很慢怎么办？
**A**: 
- 使用软字幕代替硬字幕
- 硬字幕渲染需要重新编码，速度取决于视频长度和分辨率
- 预计速度：1080p 视频约 1-2x 实时速度

### Q3: 字幕位置不合适？
**A**: 硬字幕支持自定义位置（底部/顶部/中间），软字幕位置由播放器决定。

### Q4: 支持中文字幕吗？
**A**: 完全支持中文及其他 Unicode 字符。

### Q5: 输出文件可以自定义位置吗？
**A**: 当前版本输出到视频源文件所在目录，可以在输出后手动移动文件。

### Q6: 如何提高字幕可读性？
**A**: 
- 勾选"添加字幕描边"
- 使用较大的字体大小
- 选择底部位置（背景通常较深）

## 处理流程

```
[开始]
  ↓
[选择视频文件] ←（必选）
  ↓
[选择音频/字幕] ←（至少一个）
  ↓
[配置样式参数]
  ↓
[开始渲染]
  ↓
┌─────────────┐
│ 有音频吗？   │ ─Yes→ [合并音频到视频] → temp.mp4
└─────────────┘
  ↓ No
┌─────────────┐
│ 有字幕吗？   │ ─Yes→ [渲染字幕]
└─────────────┘            ↓
  ↓ No                ┌──────────┐
[完成]  ←───────────── │硬字幕/软字幕│
                       └──────────┘
                            ↓
                       [清理临时文件]
                            ↓
                         [完成]
```

## 示例命令（参考）

### 硬字幕烧录
```bash
ffmpeg -i video.mp4 \
  -vf "subtitles=subtitle.srt:force_style='FontSize=24,Alignment=2,BorderStyle=1,Outline=2,Shadow=1'" \
  -c:v libx264 -crf 23 -preset medium \
  -c:a copy \
  output.mp4
```

### 软字幕内嵌
```bash
ffmpeg -i video.mp4 -i subtitle.srt \
  -c:v copy -c:a copy -c:s mov_text \
  -metadata:s:s:0 language=chi \
  output.mp4
```

### 音频合并
```bash
ffmpeg -i video.mp4 -i audio.mp3 \
  -c:v copy -c:a aac \
  -map 0:v:0 -map 1:a:0 \
  -shortest \
  output.mp4
```

## 最佳实践

1. **测试先行**：第一次使用时，用短视频测试效果
2. **备份原文件**：渲染会生成新文件，原文件不会被修改
3. **检查 FFmpeg**：开始前确认 FFmpeg 已正确安装
4. **合理选择类型**：
   - 分享视频 → 硬字幕
   - 个人使用 → 软字幕（灵活）
5. **注意文件大小**：硬字幕会增加文件体积

## 技术支持

如遇到问题，请检查：
1. FFmpeg 是否正确安装
2. 视频/字幕文件格式是否支持
3. 处理日志中的具体错误信息
4. 磁盘空间是否充足

---

**提示**：视频渲染功能完全在本地处理，不会上传任何数据到云端，保护您的隐私安全。

