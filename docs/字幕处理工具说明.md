# 字幕处理工具使用指南

解决字幕叠加显示的问题，让每次只显示一句话。

## 🎯 问题分析

你的字幕文件存在的问题：
- ✗ 时间跨度太长（如16秒显示多句话）
- ✗ 多个句子叠加显示
- ✗ 视觉效果混乱

期望效果：
- ✓ 每次只显示一句话
- ✓ 说完一句后自动切换到下一句
- ✓ 字幕与语音精确同步

## 📦 解决方案

### 方案1：智能分割现有字幕（快速方案）

适用于：已有字幕文件，但时间轴不准确

**使用方法：**
```bash
# 基本用法（默认3秒最大持续时间）
python split_subtitles.py "字幕文件.srt"

# 自定义最大持续时间（例如2秒）
python split_subtitles.py "字幕文件.srt" 2

# 处理你的文件
python split_subtitles.py "resource/How parades can build community  Chantelle Rytter  TEDxAtlanta.srt" 3
```

**输出：**
- 原文件：`字幕文件.srt`
- 新文件：`字幕文件_split.srt`

**特点：**
- ⚡ 快速处理
- 🔄 自动按句子分割
- 📏 平均分配时间
- 🌏 支持中英文

**限制：**
- 时间对齐基于平均分配，不一定与实际语音完全同步

---

### 方案2：AI 重新生成字幕（最佳方案）⭐

使用 OpenAI Whisper AI 重新识别语音，生成精确的时间对齐字幕。

**安装 Whisper：**
```bash
pip install openai-whisper
```

**使用方法：**
```bash
# 基本用法（英语视频）
python regenerate_subtitles.py "视频文件.mp4"

# 指定语言和模型
python regenerate_subtitles.py "视频文件.mp4" en base

# 处理你的视频（英语）
python regenerate_subtitles.py "resource/How parades can build community  Chantelle Rytter  TEDxAtlanta-1760538972.mp4" en base

# 中文视频
python regenerate_subtitles.py "chinese_video.mp4" zh small
```

**模型选择：**
- `tiny` - 最快，准确度低（几秒钟）
- `base` - 快速，准确度中等（推荐，1-2分钟）⭐
- `small` - 较慢，准确度较高（3-5分钟）
- `medium` - 慢，准确度高（10-15分钟）
- `large` - 最慢，准确度最高（20-30分钟）

**输出：**
- 新文件：`视频文件_whisper.srt`

**特点：**
- 🎯 精确的时间对齐
- 🤖 AI 自动识别语音
- 📝 每句话独立时间戳
- 🌍 支持多种语言
- ✅ 最佳效果

---

## 🎬 完整工作流程

### 推荐流程（最佳效果）：

```bash
# 步骤1：使用 Whisper AI 生成精确字幕
python regenerate_subtitles.py "你的视频.mp4" en base

# 步骤2：在字幕合并工具中使用生成的字幕
python sp_vas.py

# 在GUI中：
# 1. 选择视频文件
# 2. 选择生成的 *_whisper.srt 字幕文件
# 3. 调整字幕样式
# 4. 点击"开始执行"
```

### 快速流程（快速修复）：

```bash
# 步骤1：分割现有字幕
python split_subtitles.py "你的字幕.srt" 3

# 步骤2：在字幕合并工具中使用分割后的字幕
python sp_vas.py

# 在GUI中使用 *_split.srt 文件
```

---

## 📊 效果对比

| 方案 | 速度 | 准确度 | 时间同步 | 推荐度 |
|------|------|--------|----------|--------|
| 原始字幕 | - | ❌ 差 | ❌ 不准确 | ⭐ |
| 智能分割 | ⚡⚡⚡ 很快 | ⭐⭐⭐ 中 | ⭐⭐ 平均分配 | ⭐⭐⭐ |
| Whisper AI | ⚡⚡ 较快 | ⭐⭐⭐⭐⭐ 极高 | ⭐⭐⭐⭐⭐ 精确 | ⭐⭐⭐⭐⭐ |

---

## 🔧 实际示例

### 你的字幕文件问题：

**原始字幕（第3条）：**
```
3
00:00:35,566 --> 00:00:51,848
every single time I look out at the parade lineup. And I think I just get chills, you know? And I think, God, people are so wonderful. People are full of the loveliest surprises.
每次 看到游行队伍时，我仍然会眼眶湿润。 我觉得我只是感到寒冷，你知道吗？ 我想，天哪，人们真是太棒了。 人们心中充满了 最美好的惊喜。
```

**问题：**
- 时间跨度：16秒（太长！）
- 包含：4个英文句子 + 4个中文句子
- 结果：所有句子叠加显示

**使用智能分割后：**
```
3
00:00:35,566 --> 00:00:39,566
every single time I look out at the parade lineup.
每次 看到游行队伍时，我仍然会眼眶湿润。

4
00:00:39,566 --> 00:00:43,566
And I think I just get chills, you know?
我觉得我只是感到寒冷，你知道吗？

5
00:00:43,566 --> 00:00:47,566
And I think, God, people are so wonderful.
我想，天哪，人们真是太棒了。

6
00:00:47,566 --> 00:00:51,848
People are full of the loveliest surprises.
人们心中充满了 最美好的惊喜。
```

**使用 Whisper AI 后：**
```
（时间戳将与实际语音精确对齐，每句话的开始和结束时间都准确）
```

---

## 💡 常见问题

**Q: 我应该选择哪个方案？**
A: 
- 如果追求最佳效果：使用 **Whisper AI** ⭐
- 如果只是快速修复：使用 **智能分割**
- 如果视频很长：先用 base 模型试试，效果好就继续用

**Q: Whisper 支持哪些语言？**
A: 支持 99+ 种语言，包括：
- en (英语)
- zh (中文)
- ja (日语)
- es (西班牙语)
- fr (法语)
- de (德语)
- 等等...

**Q: 处理需要多长时间？**
A: 
- 智能分割：几秒钟
- Whisper (base模型)：约为视频时长的 1-2 倍
- 例如：8分钟视频 ≈ 10-15分钟处理

**Q: 生成的字幕可以编辑吗？**
A: 可以！生成的都是标准 SRT 格式，可以用任何文本编辑器修改。

---

## 🎨 在 sp_vas.py 中使用

生成或分割字幕后，在视频合并工具中：

```bash
# 1. 启动工具
python sp_vas.py

# 2. 在GUI中操作：
#    - 选择视频文件
#    - 选择处理后的字幕文件（*_split.srt 或 *_whisper.srt）
#    - 调整字体、颜色、位置等样式
#    - 点击"开始执行"

# 3. 等待处理完成，查看效果
```

---

## 📝 技术说明

### 智能分割算法：
1. 解析 SRT 文件，提取所有字幕条目
2. 检查每个条目的持续时间
3. 如果超过阈值（如3秒），按句子分割
4. 支持中英文句子识别（句号、问号、感叹号等）
5. 平均分配时间给每个句子
6. 保持时间轴连续性

### Whisper AI 原理：
1. 使用深度学习模型分析音频
2. 识别语音内容（转录）
3. 生成单词级别的时间戳
4. 按句子分组并生成 SRT 格式
5. 时间精度可达毫秒级

---

## 🚀 快速开始

```bash
# 最简单的方法 - 一键生成最佳字幕
python regenerate_subtitles.py "resource/How parades can build community  Chantelle Rytter  TEDxAtlanta-1760538972.mp4"

# 然后在 GUI 中使用生成的字幕
python sp_vas.py
```

---

祝你使用愉快！如有问题，欢迎反馈。

