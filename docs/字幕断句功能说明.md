# 字幕智能断句功能使用指南

## 🎯 功能概述

新增的"字幕智能断句"功能可以自动将长时间跨度的字幕分割成短句，解决字幕在视频上显示过多行的问题，让每次只显示一句话。

### 你的问题
你下载的字幕文件存在以下问题：
- ❌ 每个字幕块时间跨度太长（如20秒）
- ❌ 每个字幕块包含多个句子
- ❌ 渲染到视频上时会显示很多行，影响观感

### 解决方案
✅ 自动按句子分割字幕
✅ 智能识别中英文标点符号
✅ 平均分配时间，保持时间轴连续性
✅ 可自定义每条字幕的最大持续时间

---

## 🚀 使用方法

### 方法1：从主界面菜单打开（推荐）

1. 启动主程序：
```bash
python sp.py
```

2. 在菜单栏中选择：`工具` → `字幕智能断句`

3. 在弹出的窗口中：
   - 点击 **"选择字幕文件"** 按钮，选择你的 `.srt` 文件
   - 设置 **"单条字幕最大持续时间"**（推荐：3-5秒）
   - 点击 **"🚀 开始分割"** 按钮
   - 等待处理完成
   - 在结果预览区域查看分割后的字幕
   - 点击 **"📁 打开保存目录"** 查看生成的文件

### 方法2：使用独立测试脚本

```bash
python test_split_gui.py
```

这会直接打开字幕断句工具窗口，无需启动完整的主程序。

### 方法3：使用命令行工具（快速）

```bash
# 使用默认设置（5秒最大持续时间）
python split_subtitles.py "你的字幕文件.srt"

# 自定义最大持续时间（例如3秒）
python split_subtitles.py "你的字幕文件.srt" 3

# 处理你的TED演讲字幕
python split_subtitles.py "resource/How parades can build community  Chantelle Rytter  TEDxAtlanta.srt" 5
```

---

## 📊 实际效果对比

### 原始字幕（问题示例）
```
1
00:00:00,000 --> 00:00:20,317
Transcriber: Phương Tú Lê Reviewer: Maxime Sobrier Bringing people together these days is a feat. Thousands of people coming joyfully together to create a mile long, beautiful,
```
**问题：** 20秒内包含2-3个长句子，渲染时会显示多行

### 分割后的字幕（改善后）
```
1
00:00:00,000 --> 00:00:10,158
Transcriber: Phương Tú Lê Reviewer: Maxime Sobrier Bringing people together these days is a feat.

2
00:00:10,158 --> 00:00:20,317
Thousands of people coming joyfully together to create a mile long, beautiful,
```
**改善：** 每条字幕时间更短，文本更少，显示更清晰

---

## 💡 参数说明

### 单条字幕最大持续时间
- **默认值：** 5秒
- **推荐范围：** 3-5秒
- **作用：** 超过此时间的字幕会被智能分割

**选择建议：**
- **3秒：** 适合快节奏视频，字幕切换频繁
- **4秒：** 平衡选择，适合大多数场景
- **5秒：** 适合慢节奏视频，给观众更多阅读时间
- **6秒+：** 适合教学视频，信息密集型内容

---

## 📁 输出文件

### 文件命名规则
- **输入文件：** `你的字幕.srt`
- **输出文件：** `你的字幕_split.srt`

### 保存位置
- **GUI方式：** `~/VideoTranslate/SplitSrt/`
- **命令行方式：** 与原文件同目录

---

## 🎨 技术细节

### 智能分割算法

1. **句子识别：**
   - 识别英文标点：`. ! ?`
   - 识别中文标点：`。！？`
   - 识别次要标点：`, , ; ；`（当句子特别长时使用）

2. **时间分配：**
   - 按句子数量平均分配时间
   - 保持时间轴连续性
   - 确保最后一个句子的结束时间与原字幕一致

3. **边界情况处理：**
   - 如果无法识别句子，保留原样
   - 如果字幕已经很短（≤最大时长），不分割
   - 支持多种编码格式（UTF-8, GBK）

---

## 🔧 你的字幕处理示例

### 原始文件
```bash
resource/How parades can build community  Chantelle Rytter  TEDxAtlanta.srt
```
- 原始条目数：37条
- 问题：每条时间跨度长，包含多个句子

### 处理后
```bash
# 使用5秒最大持续时间
python split_subtitles.py "resource/How parades can build community  Chantelle Rytter  TEDxAtlanta.srt" 5
```

**结果：**
- 分割后条目数：101条
- 改善：每条字幕时间更短，文本更少
- 输出文件：`resource/How parades can build community  Chantelle Rytter  TEDxAtlanta_split.srt`

---

## 📋 常见问题

### Q1: 分割后的时间对齐准确吗？
**A:** 时间是基于平均分配的，不是基于实际语音。如果需要精确对齐，建议使用 Whisper AI 重新生成字幕：
```bash
python regenerate_subtitles.py "你的视频.mp4"
```

### Q2: 是否支持双语字幕？
**A:** 当前版本主要针对单语字幕优化。双语字幕会按行分别处理。

### Q3: 分割后字幕还是太长怎么办？
**A:** 尝试降低"最大持续时间"参数，例如从5秒改为3秒：
```bash
python split_subtitles.py "你的字幕.srt" 3
```

### Q4: 可以批量处理多个字幕文件吗？
**A:** 命令行工具目前一次处理一个文件。如需批量处理，可以编写简单的脚本：
```bash
# 批量处理示例
for file in *.srt; do
    python split_subtitles.py "$file" 5
done
```

### Q5: 生成的字幕可以编辑吗？
**A:** 完全可以！生成的是标准SRT格式，可以用任何文本编辑器或字幕编辑工具修改。

---

## 🎯 最佳实践

### 推荐工作流程

1. **分割字幕：**
```bash
python split_subtitles.py "你的字幕.srt" 5
```

2. **预览效果：**
   - 在字幕编辑器中查看 `*_split.srt`
   - 确认分割效果是否满意

3. **合成视频：**
   - 使用项目的主功能将字幕合成到视频
   - 选择分割后的字幕文件
   - 调整字体、颜色等样式
   - 生成最终视频

4. **微调（可选）：**
   - 如果发现某些地方分割不理想
   - 用文本编辑器手动微调
   - 或调整参数重新分割

---

## 📚 相关工具对比

| 工具 | 速度 | 准确度 | 时间同步 | 推荐场景 |
|------|------|--------|----------|----------|
| **字幕智能断句** | ⚡⚡⚡ 极快 | ⭐⭐⭐ 中 | ⭐⭐ 平均分配 | 快速修复现有字幕 |
| **Whisper AI重生成** | ⚡⚡ 较快 | ⭐⭐⭐⭐⭐ 极高 | ⭐⭐⭐⭐⭐ 精确 | 追求最佳质量 |
| **手动编辑** | ⚡ 很慢 | ⭐⭐⭐⭐⭐ 完美 | ⭐⭐⭐⭐⭐ 精确 | 精细调整 |

---

## 🎉 总结

通过这个新增的"字幕智能断句"功能，你可以：

✅ 快速解决字幕显示过多行的问题
✅ 提升视频观看体验
✅ 节省手动编辑字幕的时间
✅ 适配不同类型的视频内容

**你的TED演讲字幕已经可以处理了！**

```bash
# 立即尝试
python split_subtitles.py "resource/How parades can build community  Chantelle Rytter  TEDxAtlanta.srt" 5

# 或使用GUI
python test_split_gui.py
```

---

## 📞 技术支持

如有任何问题或建议，欢迎反馈！

**祝你使用愉快！** 🎊

