# 主题自适应布局更新说明

## 更新时间
2025-10-27

## 更新内容

### 🎯 核心改进
1. **全屏左右分栏布局** - 充分利用屏幕空间
2. **深色/浅色主题自适应** - 根据系统主题自动调整配色

## 📊 新布局结构

### 窗口尺寸
- **宽度**: 屏幕宽度的 95%（自动适配）
- **高度**: 屏幕高度的 95%（自动适配）
- **最小尺寸**: 1200×700

### 布局划分

```
┌─────────────────────────────────────────────────────────┐
│                  LLM 智能字幕生成工具                     │
├─────────────────┬───────────────────────────────────────┤
│                 │                                       │
│   左侧面板      │          右侧面板                      │
│   (输入控件)    │    ┌──────────────────┐              │
│                 │    │   📋 处理日志    │              │
│  • 说明信息     │    │                  │              │
│  • 视频选择     │    │  (上半部分)     │              │
│  • 字幕选择     │    │                  │              │
│  • LLM 配置     │    └──────────────────┘              │
│  • Whisper 设置 │    ┌──────────────────┐              │
│  • 开始按钮     │    │  📄 生成的字幕   │              │
│                 │    │                  │              │
│                 │    │  (下半部分)     │              │
│                 │    │                  │              │
│                 │    └──────────────────┘              │
│                 │    [打开保存目录按钮]                 │
└─────────────────┴───────────────────────────────────────┘
```

## 🎨 主题自适应配色

### 深色主题 (Dark Theme)
**检测方式**: `palette.color(QPalette.Window).lightness() < 128`

| 元素 | 颜色 | 说明 |
|------|------|------|
| 左侧背景 | `#2b2b2b` | 深灰色 |
| 右侧背景 | `#1e1e1e` | 更深的灰色 |
| 信息面板背景 | `#1e3a5f` | 深蓝色 |
| 信息面板文字 | `#90caf9` | 浅蓝色 |
| 处理日志标题 | `#64b5f6` | 明亮蓝色 |
| 日志背景 | `#1a1a1a` | 极深黑 |
| 日志文字 | `#aed581` | 绿色终端风格 |
| 字幕标题 | `#81c784` | 浅绿色 |
| 字幕背景 | `#2b2b2b` | 深灰色 |
| 字幕文字 | `#e0e0e0` | 浅灰色 |
| 文件路径 | `#64b5f6` | 明亮蓝色 |
| 复选框 | `#ffab40` / `#64b5f6` | 橙色/蓝色 |

### 浅色主题 (Light Theme)

| 元素 | 颜色 | 说明 |
|------|------|------|
| 左侧背景 | `#f5f5f5` | 浅灰色 |
| 右侧背景 | `#ffffff` | 白色 |
| 信息面板背景 | `#e3f2fd` | 浅蓝色 |
| 信息面板文字 | `#1a237e` | 深蓝色 |
| 处理日志标题 | `#1976d2` | 深蓝色 |
| 日志背景 | `#263238` | 深色终端 |
| 日志文字 | `#aed581` | 绿色终端风格 |
| 字幕标题 | `#4caf50` | 绿色 |
| 字幕背景 | `#f9f9f9` | 浅灰色 |
| 字幕文字 | `#212121` | 深灰色 |
| 文件路径 | `#2196f3` | 蓝色 |
| 复选框 | `#ff6f00` / `#1976d2` | 橙色/蓝色 |

## 🔧 技术实现

### 主题检测

```python
from PySide6.QtGui import QPalette

palette = llmsplit.palette()
is_dark_theme = palette.color(QPalette.Window).lightness() < 128
```

**原理**:
- 获取窗口的调色板
- 检查窗口背景色的亮度
- 亮度 < 128 判定为深色主题
- 亮度 >= 128 判定为浅色主题

### 条件样式设置

```python
# 示例：左侧背景色
if is_dark_theme:
    left_bg_color = "#2b2b2b"  # 深色主题
else:
    left_bg_color = "#f5f5f5"  # 浅色主题

self.left_widget.setStyleSheet(f"QFrame {{ background-color: {left_bg_color}; }}")
```

### 分割器（Splitter）

```python
# 创建可调整大小的分割器
self.splitter = QSplitter(Qt.Horizontal, llmsplit)

# 添加左右两个面板
self.splitter.addWidget(self.left_widget)
self.splitter.addWidget(self.right_widget)

# 设置初始比例 1:1
self.splitter.setSizes([800, 800])
self.splitter.setStretchFactor(0, 1)
self.splitter.setStretchFactor(1, 1)
```

### 右侧面板分割

```python
# 使用 addWidget 的权重参数
self.right_layout.addWidget(self.loglabel, 1)    # 日志占 50%
self.right_layout.addWidget(self.resultinput, 1) # 字幕占 50%
```

## 🎯 用户体验改进

### 之前的布局
- ❌ 窗口较小 (900×800)
- ❌ 日志和结果挤在下方
- ❌ 滚动查看不便
- ❌ 深色模式下刺眼

### 现在的布局
- ✅ 全屏大小，充分利用空间
- ✅ 左右分栏，清晰分离输入和输出
- ✅ 日志和结果各占一半，同时可见
- ✅ 深色/浅色主题自动适配
- ✅ 可拖动调整左右比例

## 📋 完整的元素适配列表

### 左侧面板
1. **背景颜色** ✅ 适配
2. **信息面板** ✅ 适配（背景+文字）
3. **文件路径标签** ✅ 适配
4. **复选框** ✅ 适配

### 右侧面板
1. **背景颜色** ✅ 适配
2. **处理日志标题** ✅ 适配
3. **日志区域** ✅ 适配（保持终端风格）
4. **字幕标题** ✅ 适配
5. **字幕区域** ✅ 适配
6. **文件路径标签** ✅ 适配

### 按钮
- 测试连接按钮 - 保持蓝色（明显）
- 开始生成按钮 - 保持绿色（醒目）
- 打开目录按钮 - 保持绿色

## 🖥️ 窗口尺寸适配

### 自动计算

```python
from PySide6.QtGui import QGuiApplication

screen = QGuiApplication.primaryScreen()
screen_geometry = screen.availableGeometry()
screen_height = screen_geometry.height()
screen_width = screen_geometry.width()

# 窗口大小为屏幕的 95%
window_height = int(screen_height * 0.95)
window_width = int(screen_width * 0.95)
llmsplit.resize(window_width, window_height)
```

### 不同屏幕尺寸

| 屏幕分辨率 | 窗口大小 | 最小尺寸 |
|-----------|----------|----------|
| 1920×1080 | 1824×1026 | 1200×700 |
| 2560×1440 | 2432×1368 | 1200×700 |
| 3840×2160 (4K) | 3648×2052 | 1200×700 |
| 1366×768 | 1298×730 | 1200×700 |

## 🔍 对比截图说明

### 浅色主题
```
左侧: 浅灰背景 (#f5f5f5)
右侧: 白色背景 (#ffffff)
文字: 深色，清晰易读
```

### 深色主题
```
左侧: 深灰背景 (#2b2b2b)
右侧: 极深灰背景 (#1e1e1e)
文字: 浅色，护眼舒适
```

## ⚙️ 自定义分割比例

用户可以拖动中间的分隔条调整左右面板比例：

```
默认: 50% | 50%
可调: 30% | 70%  （专注查看输出）
可调: 70% | 30%  （专注调整参数）
```

## 📝 代码变更摘要

### 文件修改
- `videotrans/ui/llmsplit.py`

### 主要变更
1. 导入 `QSplitter`, `QFrame`, `QPalette`
2. 添加主题检测逻辑
3. 创建左右分栏布局
4. 所有颜色样式条件化设置
5. 窗口尺寸自动适配屏幕

### 新增代码行数
- 约 150 行（包括主题适配逻辑）

## 🎉 总结

通过这次更新：

✅ **空间利用**: 全屏显示，左右分栏
✅ **视觉舒适**: 深色/浅色主题自动适配
✅ **信息可见**: 日志和结果同时可见
✅ **灵活调整**: 可拖动调整面板比例
✅ **护眼友好**: 深色模式下不刺眼

**用户体验大幅提升！** 🚀

---

**更新日期**: 2025-10-27  
**实现者**: AI Assistant  
**版本**: 3.0.0  
**状态**: ✅ 已完成

