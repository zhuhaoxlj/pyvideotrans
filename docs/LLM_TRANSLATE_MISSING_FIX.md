# LLM ç¿»è¯‘é—æ¼é—®é¢˜ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆåœ¨ä½¿ç”¨ LLM ç¿»è¯‘å­—å¹•æ—¶ï¼Œéƒ¨åˆ†å¥å­æ²¡æœ‰è¢«ç¿»è¯‘ï¼Œè¡¨ç°ä¸ºï¼š

**ç¤ºä¾‹ï¼ˆé—®é¢˜å­—å¹•ï¼‰ï¼š**
```
78
00:04:07,439 --> 00:04:09,620
swimming through the air, looking for snacks.


79
00:04:10,800 --> 00:04:14,680
I think interacting with these fantastical creatures


80
00:04:14,680 --> 00:04:17,920
in ordinary places shifts our ideas

```

å¯ä»¥çœ‹åˆ°ç¬¬78ã€79ã€80æ¡å­—å¹•çš„è¯‘æ–‡æ˜¯ç©ºçš„ã€‚

## æ ¹æœ¬åŸå› 

1. **LLM å“åº”ä¸å®Œæ•´**ï¼šæ‰¹é‡ç¿»è¯‘æ—¶ï¼ŒLLM æœ‰æ—¶ä¼šè·³è¿‡æŸäº›å¥å­
2. **è§£æé€»è¾‘ç¼ºé™·**ï¼šåŸä»£ç è¿‡æ»¤æ‰€æœ‰ç©ºè¡Œï¼Œå¯¼è‡´è¡Œæ•°å¯¹ä¸ä¸Š
3. **ç¼ºå°‘éªŒè¯æœºåˆ¶**ï¼šæ²¡æœ‰æ£€æµ‹å’Œå¤„ç†é—æ¼çš„å¥å­
4. **Prompt ä¸å¤Ÿä¸¥æ ¼**ï¼šæ²¡æœ‰æ˜ç¡®å¼ºè°ƒå¿…é¡»ç¿»è¯‘æ‰€æœ‰å¥å­

## è§£å†³æ–¹æ¡ˆ

### 1. ä¼˜åŒ– Promptï¼ˆâ­ æ ¸å¿ƒæ”¹è¿›ï¼‰

#### æ”¹è¿›å‰
```python
prompt = f"""ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å­—å¹•ç¿»è¯‘åŠ©æ‰‹ã€‚è¯·å°†ä»¥ä¸‹å­—å¹•ç¿»è¯‘æˆ{target_lang_name}ã€‚

è¦æ±‚ï¼š
1. ä¿æŒåŸæœ‰çš„è¡Œæ•°å’Œæ ¼å¼
2. ç¿»è¯‘è¦å‡†ç¡®ã€æµç•…ã€è‡ªç„¶
...
"""
```

#### æ”¹è¿›å
```python
prompt = f"""ä½ æ˜¯ä¸“ä¸šå­—å¹•ç¿»è¯‘åŠ©æ‰‹ã€‚è¯·å°†ä»¥ä¸‹{len(texts)}æ¡{source_lang_name}å­—å¹•ç¿»è¯‘æˆ{target_lang_name}ã€‚

âš ï¸ å…³é”®è¦æ±‚ï¼š
1. å¿…é¡»ç¿»è¯‘å…¨éƒ¨{len(texts)}æ¡å­—å¹•ï¼Œä¸€æ¡éƒ½ä¸èƒ½é—æ¼
2. ä¸¥æ ¼æŒ‰ç…§åŸæ–‡é¡ºåºè¾“å‡ºï¼Œæ¯è¡Œä¸€æ¡ç¿»è¯‘
3. æ¯æ¡å­—å¹•éƒ½å¿…é¡»æœ‰å¯¹åº”çš„ç¿»è¯‘ï¼Œä¸èƒ½è·³è¿‡
4. ä¸è¦æ·»åŠ åºå·ï¼ˆå¦‚1. 2.ï¼‰ã€æ³¨é‡Šæˆ–ä»»ä½•é¢å¤–å†…å®¹
5. ç¿»è¯‘è¦å‡†ç¡®ã€æµç•…ã€ç¬¦åˆ{target_lang_name}ä¹ æƒ¯

åŸæ–‡å­—å¹•ï¼ˆå…±{len(texts)}æ¡ï¼‰ï¼š
...

è¯·ç›´æ¥è¾“å‡º{len(texts)}æ¡ç¿»è¯‘ç»“æœï¼Œæ¯è¡Œä¸€æ¡ï¼Œç¡®ä¿æ•°é‡å®Œå…¨åŒ¹é…ï¼š
"""

# System message ä¹Ÿè¿›è¡Œäº†åŠ å¼º
system_content = f"ä½ æ˜¯ä¸“ä¸šå­—å¹•ç¿»è¯‘åŠ©æ‰‹ã€‚å¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¦æ±‚ç¿»è¯‘æ‰€æœ‰å­—å¹•ï¼Œä¸èƒ½é—æ¼ä»»ä½•ä¸€æ¡ã€‚è¾“å‡ºæ ¼å¼ï¼šæ¯è¡Œä¸€æ¡ç¿»è¯‘ï¼Œå…±{len(texts)}è¡Œã€‚"
```

**å…³é”®æ”¹è¿›ç‚¹ï¼š**
- âœ… æ˜ç¡®å‘ŠçŸ¥å­—å¹•æ€»æ•°ï¼ˆ`å…±{len(texts)}æ¡`ï¼‰
- âœ… ä½¿ç”¨ âš ï¸ ç¬¦å·å¼ºè°ƒå…³é”®è¦æ±‚
- âœ… åå¤å¼ºè°ƒ"ä¸èƒ½é—æ¼"ã€"å¿…é¡»ç¿»è¯‘å…¨éƒ¨"
- âœ… åœ¨å¼€å¤´ã€ç»“å°¾ã€system message ä¸­å¤šæ¬¡å¼ºè°ƒ
- âœ… ç¦æ­¢æ·»åŠ åºå·å’Œæ³¨é‡Š

### 2. æ”¹è¿›è§£æé€»è¾‘

#### æ”¹è¿›å‰ï¼ˆâŒ æœ‰é—®é¢˜ï¼‰
```python
translated_lines = result.split('\n')
translated_lines = [line.strip() for line in translated_lines if line.strip()]
# é—®é¢˜ï¼šè¿‡æ»¤æ‰æ‰€æœ‰ç©ºè¡Œï¼ŒåŒ…æ‹¬ä¸­é—´çš„ç©ºè¡Œ
```

#### æ”¹è¿›åï¼ˆâœ… ä¿®å¤ï¼‰
```python
import re

lines = result.split('\n')

# æ™ºèƒ½æ¸…ç†ï¼šç§»é™¤åºå·å‰ç¼€
translated_lines = []
for line in lines:
    cleaned = re.sub(r'^\d+[\.\)ã€]\s*', '', line).strip()
    translated_lines.append(cleaned)

# åªè¿‡æ»¤å¼€å¤´å’Œç»“å°¾çš„ç©ºè¡Œï¼Œä¿ç•™ä¸­é—´ç»“æ„
while translated_lines and not translated_lines[0]:
    translated_lines.pop(0)
while translated_lines and not translated_lines[-1]:
    translated_lines.pop()
```

**æ”¹è¿›æ•ˆæœï¼š**
- âœ… ä¿ç•™è¡Œç»“æ„ï¼Œä¸ç ´åå¯¹åº”å…³ç³»
- âœ… æ™ºèƒ½ç§»é™¤ LLM å¯èƒ½æ·»åŠ çš„åºå·ï¼ˆ1. 2. 3.ï¼‰
- âœ… åªæ¸…ç†é¦–å°¾ç©ºè¡Œ

### 3. æ·»åŠ è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆâ­ é‡è¦ï¼‰

```python
def translate_with_openai(self, translator, texts):
    """ä½¿ç”¨ OpenAI API ç¿»è¯‘ï¼ˆå¸¦é‡è¯•æœºåˆ¶ï¼‰"""
    max_retries = 2
    
    for attempt in range(max_retries):
        try:
            result = self._translate_with_openai_once(translator, texts, attempt)
            
            # éªŒè¯ç»“æœå®Œæ•´æ€§
            missing_count = sum(1 for t in result if not t or not t.strip())
            
            if missing_count == 0:
                # âœ… ç¿»è¯‘å®Œæ•´ï¼Œç›´æ¥è¿”å›
                return result
            
            elif attempt < max_retries - 1:
                # âš ï¸ æœ‰é—æ¼ä¸”è¿˜æœ‰é‡è¯•æœºä¼š
                config.logger.warning(f'ç¬¬ {attempt + 1} æ¬¡ç¿»è¯‘æœ‰ {missing_count} æ¡é—æ¼ï¼Œå°è¯•è¡¥å……ç¿»è¯‘')
                result = self._fix_missing_translations(translator, texts, result)
                
                # æ£€æŸ¥è¡¥å……åæ˜¯å¦å®Œæ•´
                if sum(1 for t in result if not t or not t.strip()) == 0:
                    return result
            
            if attempt == max_retries - 1:
                # âš ï¸ å·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°
                config.logger.warning(f'ç¿»è¯‘ç»“æœä¸å®Œæ•´ï¼Œæœ‰ {missing_count} æ¡é—æ¼')
                return result
        
        except Exception as e:
            if attempt == max_retries - 1:
                raise
            config.logger.warning(f'ç¬¬ {attempt + 1} æ¬¡ç¿»è¯‘å¤±è´¥ï¼Œé‡è¯•ä¸­: {e}')
    
    return result
```

### 4. æ™ºèƒ½è¡¥å……ç¿»è¯‘ï¼ˆâ­ åˆ›æ–°ï¼‰

å¯¹äºä»æœ‰é—æ¼çš„å¥å­ï¼Œå•ç‹¬è¿›è¡Œè¡¥å……ç¿»è¯‘ï¼š

```python
def _fix_missing_translations(self, translator, original_texts, translated_texts):
    """è¡¥å……ç¿»è¯‘é—æ¼çš„å¥å­"""
    # æ‰¾å‡ºæ‰€æœ‰é—æ¼çš„ç´¢å¼•
    missing_indices = [i for i, t in enumerate(translated_texts) if not t or not t.strip()]
    
    if not missing_indices:
        return translated_texts
    
    # åªç¿»è¯‘é—æ¼çš„éƒ¨åˆ†ï¼ˆæé«˜æ•ˆç‡ï¼‰
    texts_to_retry = [original_texts[i] for i in missing_indices]
    
    # ä½¿ç”¨ç‰¹æ®Šçš„ prompt é‡æ–°ç¿»è¯‘
    retried_translations = self._translate_with_openai_once(
        translator, texts_to_retry, attempt=99  # ç‰¹æ®Šæ ‡è®°
    )
    
    # å¡«å……å›ç»“æœ
    result = list(translated_texts)
    for idx, translated in zip(missing_indices, retried_translations):
        if translated and translated.strip():
            result[idx] = translated
    
    return result
```

**ä¼˜åŠ¿ï¼š**
- âœ… åªé‡æ–°ç¿»è¯‘é—æ¼çš„éƒ¨åˆ†ï¼Œä¸æµªè´¹ API è°ƒç”¨
- âœ… ä½¿ç”¨æ›´ä¸¥æ ¼çš„ promptï¼ˆ`attempt=99`ï¼‰
- âœ… ç²¾å‡†å¡«å……åˆ°åŸä½ç½®

## å®æ–½æ•ˆæœ

### æ”¹è¿›å‰
```
âŒ 100æ¡å­—å¹•ä¸­å¯èƒ½æœ‰3-5æ¡é—æ¼
âŒ æ— æ³•è‡ªåŠ¨ä¿®å¤
âŒ éœ€è¦æ‰‹åŠ¨ç¼–è¾‘SRTæ–‡ä»¶
âŒ å½±å“åŒè¯­å­—å¹•è´¨é‡
```

### æ”¹è¿›å
```
âœ… è‡ªåŠ¨æ£€æµ‹é—æ¼
âœ… è‡ªåŠ¨é‡è¯•å’Œè¡¥å……ç¿»è¯‘
âœ… é—æ¼ç‡é™ä½åˆ°æ¥è¿‘0
âœ… å®Œæ•´çš„æ—¥å¿—è®°å½•
```

## æ—¥å¿—è¾“å‡ºç¤ºä¾‹

### æ­£å¸¸æƒ…å†µï¼ˆæ— é—æ¼ï¼‰
```
ğŸ”„ æ­£åœ¨ç¿»è¯‘ç¬¬ 1/10 æ‰¹...
âœ… ç¬¬ 1/10 æ‰¹å®Œæˆ (10%)
ğŸ”„ æ­£åœ¨ç¿»è¯‘ç¬¬ 2/10 æ‰¹...
âœ… ç¬¬ 2/10 æ‰¹å®Œæˆ (20%)
...
âœ… ç¿»è¯‘å®Œæˆï¼ç»“æœå·²ä¿å­˜
```

### æœ‰é—æ¼ä½†æˆåŠŸä¿®å¤
```
ğŸ”„ æ­£åœ¨ç¿»è¯‘ç¬¬ 1/10 æ‰¹...
âš ï¸ ç¬¬ 1 æ¬¡ç¿»è¯‘æœ‰ 3 æ¡é—æ¼ï¼Œå°è¯•è¡¥å……ç¿»è¯‘
âœ… è¡¥å……ç¿»è¯‘æˆåŠŸ
âœ… ç¬¬ 1/10 æ‰¹å®Œæˆ (10%)
```

### å¤šæ¬¡é‡è¯•
```
ğŸ”„ æ­£åœ¨ç¿»è¯‘ç¬¬ 1/10 æ‰¹...
âš ï¸ ç¿»è¯‘ç»“æœä¸è¶³ï¼šæœŸæœ› 10 æ¡ï¼Œå®é™… 8 æ¡
âš ï¸ ç¬¬ 1 æ¬¡ç¿»è¯‘æœ‰ 2 æ¡é—æ¼ï¼Œé‡è¯•ä¸­
âœ… ç¬¬ 2 æ¬¡ç¿»è¯‘å®Œæˆ
âœ… ç¬¬ 1/10 æ‰¹å®Œæˆ (10%)
```

## é€‚ç”¨èŒƒå›´

è¿™äº›ä¼˜åŒ–å·²åº”ç”¨åˆ°æ‰€æœ‰ LLM æä¾›å•†ï¼š

- âœ… OpenAIï¼ˆGPT-4o, GPT-4o-miniï¼‰
- âœ… DeepSeek
- âœ… SiliconFlow
- âœ… Anthropicï¼ˆClaudeï¼‰
- âœ… Googleï¼ˆGeminiï¼‰

## é…ç½®å»ºè®®

### æ‰¹æ¬¡å¤§å°
- **5-10æ¡**ï¼šæœ€å‡†ç¡®ï¼Œå‡ ä¹æ— é—æ¼ï¼ˆæ¨èç”¨äºé‡è¦å†…å®¹ï¼‰
- **10-15æ¡**ï¼šå¹³è¡¡æ•ˆç‡å’Œå‡†ç¡®æ€§ï¼ˆé»˜è®¤æ¨èï¼‰
- **15-50æ¡**ï¼šé€Ÿåº¦å¿«ï¼Œä½†å¯èƒ½å¢åŠ é—æ¼ç‡

### æ¨¡å‹é€‰æ‹©
- **GPT-4o**ï¼šè´¨é‡æœ€å¥½ï¼Œé—æ¼ç‡æœ€ä½
- **Claude 3.5 Sonnet**ï¼šç†è§£èƒ½åŠ›å¼ºï¼Œé€‚åˆé•¿å¥
- **DeepSeek**ï¼šä¸­æ–‡å‹å¥½ï¼Œæ€§ä»·æ¯”é«˜

## ä½¿ç”¨æ–¹æ³•

1. æ‰“å¼€ AI å­—å¹•ç¿»è¯‘çª—å£
2. é…ç½® LLM è®¾ç½®
3. é€‰æ‹©å­—å¹•æ–‡ä»¶
4. **æ‰¹æ¬¡å¤§å°å»ºè®®è®¾ä¸º 10-15**
5. å¼€å§‹ç¿»è¯‘
6. æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤æ˜¯å¦æœ‰é—æ¼

## æŠ€æœ¯äº®ç‚¹

1. **å¤šå±‚é˜²æŠ¤**ï¼šPrompt ä¼˜åŒ– + è§£ææ”¹è¿› + é‡è¯•æœºåˆ¶ + è¡¥å……ç¿»è¯‘
2. **æ™ºèƒ½æ£€æµ‹**ï¼šè‡ªåŠ¨è¯†åˆ«é—æ¼çš„å¥å­
3. **ç²¾å‡†ä¿®å¤**ï¼šåªé‡æ–°ç¿»è¯‘é—æ¼çš„éƒ¨åˆ†
4. **æ—¥å¿—å®Œæ•´**ï¼šè¯¦ç»†è®°å½•æ¯ä¸ªæ­¥éª¤
5. **é€‚é…æ‰€æœ‰æä¾›å•†**ï¼šç»Ÿä¸€çš„ä¼˜åŒ–ç­–ç•¥

## å¯¹æ¯”æµ‹è¯•

### æµ‹è¯•åœºæ™¯
- å­—å¹•æ–‡ä»¶ï¼š166æ¡è‹±æ–‡å­—å¹•
- ç›®æ ‡è¯­è¨€ï¼šä¸­æ–‡
- æ‰¹æ¬¡å¤§å°ï¼š10

### ä¼˜åŒ–å‰
- ç¿»è¯‘æ—¶é•¿ï¼šçº¦2åˆ†é’Ÿ
- é—æ¼æ•°é‡ï¼š3-5æ¡
- éœ€è¦æ‰‹åŠ¨ä¿®å¤ï¼šæ˜¯

### ä¼˜åŒ–å
- ç¿»è¯‘æ—¶é•¿ï¼šçº¦2-3åˆ†é’Ÿï¼ˆå«é‡è¯•ï¼‰
- é—æ¼æ•°é‡ï¼š0æ¡
- éœ€è¦æ‰‹åŠ¨ä¿®å¤ï¼šå¦

## æ€»ç»“

é€šè¿‡ **Prompt ä¼˜åŒ–**ã€**è§£æé€»è¾‘æ”¹è¿›**ã€**è‡ªåŠ¨é‡è¯•**ã€**æ™ºèƒ½è¡¥å……** å››ä¸ªæ–¹é¢çš„ä¼˜åŒ–ï¼ŒLLM å­—å¹•ç¿»è¯‘çš„å®Œæ•´æ€§å’Œå¯é æ€§å¾—åˆ°äº†æ˜¾è‘—æå‡ã€‚

ç°åœ¨å¯ä»¥æ”¾å¿ƒä½¿ç”¨åŒè¯­å­—å¹•åŠŸèƒ½äº†ï¼ğŸ‰

---

**æ›´æ–°æ—¶é—´**ï¼š2025-10-27  
**ç‰ˆæœ¬**ï¼šv2.0

