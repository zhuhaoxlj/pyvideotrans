# LLM 字幕翻译功能使用指南

## 功能简介

LLM 字幕翻译是一个基于大语言模型（LLM）的智能字幕翻译工具。它支持多种主流 LLM 服务商，能够准确、流畅地翻译字幕文件。

## 支持的 LLM 提供商

- **OpenAI**: GPT-4o, GPT-4o-mini, GPT-4-turbo, GPT-3.5-turbo
- **Claude**: Claude 3.5 Sonnet, Claude 3 Opus, Claude 3 Sonnet, Claude 3 Haiku
- **Gemini**: Gemini 2.0 Flash, Gemini 1.5 Pro, Gemini 1.5 Flash
- **DeepSeek**: DeepSeek Chat, DeepSeek Coder

## 使用步骤

### 1. 启动程序

运行主程序：
```bash
python main.py
```

### 2. 打开 AI 字幕翻译窗口

在主菜单中点击 **"AI字幕翻译"** 按钮。

### 3. 配置 LLM 参数

#### 3.1 选择 LLM 提供商
从下拉菜单中选择你要使用的 LLM 提供商（OpenAI、Claude、Gemini 或 DeepSeek）。

#### 3.2 输入 API Key
- 在 **API Key** 输入框中输入你的 API 密钥
- API Key 会以密码形式显示以保护隐私

#### 3.3 选择模型
- 根据你选择的提供商，会自动显示可用的模型列表
- 你也可以手动输入其他模型名称

#### 3.4 设置 API 地址（可选）
- 如果使用官方 API，可以留空
- 如果使用代理或自建服务，请输入完整的 API 地址

### 4. 设置语言选项

#### 4.1 源语言
- 默认为"自动检测"
- 也可以手动指定源语言以提高准确性

#### 4.2 目标语言
- 从下拉菜单中选择你要翻译成的目标语言
- 目标语言不能选择"自动检测"

### 5. 调整翻译参数

#### 5.1 批次大小
- 设置每次发送给 LLM 的字幕条数
- 默认值：10
- 建议范围：5-20
- 批次越大，翻译速度越快，但可能降低准确性

#### 5.2 网络代理（可选）
- 如果需要通过代理访问 API，请输入代理地址
- 格式：`http://127.0.0.1:7890`

### 6. 选择字幕文件

点击 **"选择字幕文件 (.srt)"** 按钮，选择要翻译的 SRT 字幕文件。

选择后：
- 文件路径会显示在按钮下方
- 左侧预览区会显示原文字幕内容

### 7. 开始翻译

点击 **"开始翻译"** 按钮开始翻译过程。

翻译过程中：
- 进度会实时显示在进度标签中
- 右侧预览区会实时显示翻译结果
- 可以点击 **"停止"** 按钮随时中止翻译

### 8. 查看结果

翻译完成后：
- 右侧预览区显示完整的翻译结果
- 结果自动保存在 `~/Videos/pyvideotrans/LLMTranslate/` 目录
- 文件命名格式：`原文件名_translated_目标语言.srt`

点击 **"打开结果文件夹"** 按钮可以快速打开保存目录。

## 配置示例

### OpenAI 配置示例

```
LLM提供商: OpenAI
API Key: sk-xxx...
模型: gpt-4o-mini
API地址: (留空)
源语言: 自动检测
目标语言: 中文
批次大小: 10
网络代理: (留空或 http://127.0.0.1:7890)
```

### Claude 配置示例

```
LLM提供商: Claude
API Key: sk-ant-xxx...
模型: claude-3-5-sonnet-20241022
API地址: (留空)
源语言: 英语
目标语言: 中文
批次大小: 10
网络代理: (留空)
```

### Gemini 配置示例

```
LLM提供商: Gemini
API Key: AIza...
模型: gemini-2.0-flash-exp
API地址: (留空)
源语言: 自动检测
目标语言: 英语
批次大小: 15
网络代理: (留空)
```

### DeepSeek 配置示例

```
LLM提供商: DeepSeek
API Key: sk-xxx...
模型: deepseek-chat
API地址: (留空，自动使用 https://api.deepseek.com/v1)
源语言: 自动检测
目标语言: 英语
批次大小: 10
网络代理: (留空)
```

## 注意事项

### 1. API Key 安全
- 请妥善保管你的 API Key
- 不要在公共场合分享你的 API Key
- 建议定期更换 API Key

### 2. API 费用
- 使用 LLM API 会产生费用
- 不同模型的费用不同，请查阅各服务商的定价
- 建议在 API 服务商后台设置费用上限

### 3. 翻译质量
- 模型越强大，翻译质量越好，但费用也越高
- 批次大小会影响翻译质量，建议根据实际情况调整
- 对于重要内容，建议人工校对翻译结果

### 4. 网络连接
- 确保网络连接稳定
- 如果无法访问 API，请检查网络代理设置
- 部分地区可能需要配置代理才能访问某些 API

### 5. 文件格式
- 仅支持标准 SRT 格式的字幕文件
- 确保源文件编码为 UTF-8
- 如果文件格式不正确，可能导致解析失败

## 常见问题

### Q1: 提示"请输入 API Key"
**A:** 请确保在 API Key 输入框中输入了有效的 API 密钥。

### Q2: 翻译失败，显示网络错误
**A:** 请检查：
- 网络连接是否正常
- API Key 是否正确
- 是否需要配置网络代理
- API 服务商是否有区域限制

### Q3: 翻译结果不准确
**A:** 可以尝试：
- 更换更强大的模型
- 减小批次大小
- 明确指定源语言而不是使用自动检测
- 检查源字幕是否有错误

### Q4: 翻译速度很慢
**A:** 可以尝试：
- 增加批次大小
- 更换响应更快的模型
- 检查网络连接速度

### Q5: 如何获取 API Key？
**A:** 
- OpenAI: https://platform.openai.com/api-keys
- Claude: https://console.anthropic.com/
- Gemini: https://makersuite.google.com/app/apikey
- DeepSeek: https://platform.deepseek.com/

## 技术特性

### 1. 智能批处理
- 自动将字幕分批发送给 LLM
- 提高翻译效率，降低 API 调用次数

### 2. 实时预览
- 翻译过程中实时显示结果
- 左右分栏显示原文和译文

### 3. 错误处理
- 自动重试机制
- 失败时保留原文
- 详细的错误日志

### 4. 结果保存
- 自动保存翻译结果
- 保留原始 SRT 格式
- 清晰的文件命名

## 反馈与支持

如果在使用过程中遇到问题或有改进建议，欢迎：
1. 查看日志文件：`~/Videos/pyvideotrans/logs/`
2. 提交 Issue
3. 参与讨论

---

**版本**: 1.0.0  
**更新日期**: 2025-01-27

