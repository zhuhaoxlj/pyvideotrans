# 🎬 PyVideoTrans 字幕生成功能使用指南

## ✨ 功能说明

已成功集成 Whisper Auto Captions 字幕生成功能到主菜单！

### 新功能

1. **主界面顶部拖放区域** - 渐变紫色大区域
   - 📝 文案：**"拖入视频开始智能生成字幕"**
   - 🎯 功能：拖放或点击选择视频文件，自动启动字幕生成

2. **集成 Whisper AI** - 使用 OpenAI Whisper 模型
   - 支持多种模型：Large-v3, Large-v3-Turbo, Large, Medium, Small, Base, Tiny
   - 支持 90+ 种语言
   - 自动检测视频帧率
   - GPU 加速（CUDA/MPS/CPU）

## 🚀 快速开始

### 1. 检查环境

运行设置脚本检查环境：

```bash
cd /Users/mark/Downloads/pyvideotrans
./setup_subtitle_integration.sh
```

应该看到：
```
✅ 找到 get_srt_zimu 目录
✅ get_srt_zimu/main.py
✅ get_srt_zimu/ui/main_window.py
✅ 所有必要文件都存在！
```

### 2. 启动程序

```bash
# 使用 uv（推荐）
uv run python main.py

# 或使用 python
python main.py
```

### 3. 使用字幕生成功能

#### 方式 1：拖放视频文件

1. 启动程序后，看到主菜单
2. 将视频文件拖放到**顶部紫色渐变区域**
3. 自动打开 Whisper Auto Captions 窗口
4. 视频路径和帧率已自动填充
5. 选择模型和语言，点击 "Create" 开始生成

#### 方式 2：点击选择

1. 点击顶部紫色渐变区域
2. 在弹出的文件对话框中选择视频
3. 后续步骤同上

## 📋 支持的格式

### 视频格式
- MP4, MOV, AVI, MKV
- FLV, WMV, WEBM, M4V
- MPEG, MPG

### 音频格式（也支持）
- MP3, WAV, M4A, FLAC

## ⚙️ Whisper 模型说明

| 模型 | 大小 | 速度 | 精度 | 推荐场景 |
|------|------|------|------|---------|
| **Large-v3** | ~3GB | 慢 | 最高 | 专业制作，质量优先 |
| **Large-v3-Turbo** | ~1.5GB | 较快 | 很高 | 推荐！质量和速度平衡 ⭐ |
| Large | ~3GB | 慢 | 很高 | 旧版高质量 |
| Medium | ~1.5GB | 中等 | 高 | 日常使用 |
| Small | ~500MB | 快 | 中等 | 快速测试 |
| Base | ~150MB | 很快 | 低 | 预览/草稿 |
| Tiny | ~75MB | 极快 | 很低 | 仅测试 |

**首次使用会自动下载模型**，下载进度会在输出窗口显示。

## 🌍 支持的语言

包括但不限于：
- 中文（简体/繁体）
- 英语、日语、韩语
- 法语、德语、西班牙语
- 阿拉伯语、俄语、印地语
- 等 90+ 种语言

## 📁 输出文件

生成的字幕文件保存在：

```
~/Videos/pyvideotrans/
├── [项目名].srt          # SRT 字幕文件
└── [项目名].fcpxml       # Final Cut Pro XML 文件
```

## 🔧 技术细节

### 集成方式

```
主菜单（main.py）
    ↓ 拖放视频
视频检测（set_form.py）
    ↓ 打开字幕生成窗口
Whisper Auto Captions（get_srt_zimu/）
    ↓ 处理视频
生成 SRT + FCPXML 文件
```

### 文件结构

```
pyvideotrans/
├── main.py                          # 主程序
├── videotrans/
│   ├── ui/main_menu.py             # 主菜单 UI（已修改）
│   └── component/set_form.py       # 表单处理（已修改）
└── get_srt_zimu/                   # 字幕生成模块
    ├── main.py
    ├── ui/
    │   ├── main_window.py          # 字幕生成主窗口
    │   ├── home_view.py            # 文件选择界面
    │   └── process_view.py         # 处理进度界面
    └── utils/
        └── whisper_processor.py    # Whisper 处理器
```

## ⚡ GPU 加速

程序会自动检测并使用最佳设备：

- **NVIDIA GPU**: 使用 CUDA 加速 🚀
- **Apple Silicon**: 使用 MPS 加速 🍎
- **CPU**: 使用 CPU 处理 💻

在输出窗口会显示使用的设备类型。

## 📝 修改内容总结

### 1. UI 修改（`videotrans/ui/main_menu.py`）

- ✅ 将视频拖放区域移到标题下方（最上面）
- ✅ 改用渐变紫色背景（`#667eea` → `#764ba2`）
- ✅ 增大区域高度（160px → 200px）
- ✅ 修改文案：**"拖入视频开始智能生成字幕"**
- ✅ 删除原来底部的帧率检测区域

### 2. 功能集成（`videotrans/component/set_form.py`）

- ✅ 修改 `_process_video_file` 方法
- ✅ 集成 Whisper Auto Captions 窗口
- ✅ 自动检测并添加 `get_srt_zimu` 路径
- ✅ 自动填充视频路径和帧率
- ✅ 窗口切换逻辑（隐藏主菜单 → 显示字幕生成窗口）

## 🐛 故障排除

### 问题 1: "找不到字幕生成模块"

**原因**: `get_srt_zimu` 目录不在正确位置

**解决方案**:
```bash
# 检查目录是否存在
ls -la /Users/mark/Downloads/pyvideotrans/get_srt_zimu

# 运行设置脚本
./setup_subtitle_integration.sh
```

### 问题 2: "No module named 'ui'"

**原因**: Python 路径设置问题

**解决方案**: 已在代码中自动处理，确保 `get_srt_zimu` 在项目目录下

### 问题 3: 窗口无法打开

**原因**: 依赖包未安装

**解决方案**:
```bash
# 安装 get_srt_zimu 的依赖
cd get_srt_zimu
pip install -r requirements.txt
```

### 问题 4: GPU 加速不工作

**Apple Silicon Mac**:
```bash
# 确保安装了支持 MPS 的 PyTorch
pip install torch torchaudio
```

**NVIDIA GPU**:
```bash
# 安装 CUDA 版本的 PyTorch
pip install torch torchaudio --index-url https://download.pytorch.org/whl/cu118
```

## 💡 使用技巧

1. **首次使用**: 建议先使用 Small 或 Base 模型测试，速度快
2. **正式制作**: 使用 Large-v3-Turbo，质量和速度兼顾
3. **长视频**: 程序会自动分割成 10 分钟片段处理
4. **模型下载**: 首次使用会下载模型，请耐心等待
5. **输出窗口**: 查看实时处理进度和转录文本

## 🎨 UI 预览

### 主菜单（修改后）

```
┌─────────────────────────────────────┐
│   🎬 PyVideoTrans 工具集           │
├─────────────────────────────────────┤
│                                     │
│  ┌───────────────────────────────┐ │
│  │  🎬 拖入视频开始智能生成字幕  │ │  ← 新位置（顶部）
│  │  支持 MP4、MOV、AVI、MKV     │ │     渐变紫色
│  └───────────────────────────────┘ │
│                                     │
│  ┌───────────────────────────────┐ │
│  │  🤖 AI智能分割字幕           │ │
│  └───────────────────────────────┘ │
│                                     │
│  ┌───────────────────────────────┐ │
│  │  🌍 AI字幕翻译               │ │
│  └───────────────────────────────┘ │
│                                     │
│  ┌───────────────────────────────┐ │
│  │  🎥 视频渲染字幕             │ │
│  └───────────────────────────────┘ │
└─────────────────────────────────────┘
```

## 📞 需要帮助？

- 查看 Whisper Auto Captions 文档：`get_srt_zimu/README_PYTHON.md`
- 查看主项目文档：`docs/` 目录
- 运行设置脚本检查环境：`./setup_subtitle_integration.sh`

## ✅ 测试清单

- [ ] 主菜单顶部显示紫色渐变拖放区域
- [ ] 文案显示"拖入视频开始智能生成字幕"
- [ ] 拖放视频文件能打开字幕生成窗口
- [ ] 点击区域能选择视频文件
- [ ] 视频路径和帧率自动填充
- [ ] 字幕生成功能正常工作
- [ ] 关闭字幕生成窗口后回到主菜单

---

**集成完成！** ✨ 现在可以直接从主菜单拖放视频生成字幕了！

**推荐工作流**:
1. 拖放视频到主菜单 → 生成原始字幕（SRT）
2. 使用"AI智能分割字幕"按钮 → 优化断句
3. 使用"AI字幕翻译"按钮 → 翻译成其他语言
4. 使用"视频渲染字幕"按钮 → 渲染到视频中

🎉 祝使用愉快！

